<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Booking</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Polished Product Description Styles */
        .product-hero {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            padding: 40px 20px;
            margin: 20px 0;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 71, 171, 0.1);
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .back-navigation {
            margin-bottom: 30px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #0047AB;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            padding: 10px 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 71, 171, 0.1);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(0, 71, 171, 0.2);
        }

        .product-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        .product-image-section {
            position: relative;
        }

        .image-container {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .image-container:hover .product-image {
            transform: scale(1.05);
        }

        .image-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .stock-badge {
            background: rgba(0, 71, 171, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .product-details {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .product-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #191970;
            margin: 0;
            line-height: 1.2;
        }

        .product-price-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .price-amount {
            font-size: 2rem;
            font-weight: bold;
            color: #0047AB;
        }

        .price-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .product-description {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .core-description {
            font-size: 1.1rem;
            color: #0047AB;
            font-weight: 500;
            line-height: 1.6;
            padding: 15px;
            background: rgba(0, 71, 171, 0.05);
            border-radius: 12px;
            border-left: 4px solid #0047AB;
        }

        .equipment-description {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
            margin: 0;
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .quantity-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quantity-label {
            font-weight: 600;
            color: #0047AB;
            font-size: 0.95rem;
        }

        .quantity-input-wrapper {
            display: flex;
            align-items: center;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }

        .quantity-btn {
            background: #f8f9fa;
            border: none;
            padding: 12px 16px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #0047AB;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: #e8f2ff;
        }

        .quantity-btn:disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        #quantityInput {
            border: none;
            padding: 12px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            width: 80px;
            background: white;
        }

        #quantityInput:focus {
            outline: none;
        }

        .stock-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(0, 71, 171, 0.1);
            color: #0047AB;
            font-weight: 600;
        }

        .status-indicator i {
            font-size: 0.8rem;
        }

        .sold-out-message {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #dc3545 0%, #c62828 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .booking-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .booking-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .booking-title {
            font-size: 2rem;
            font-weight: bold;
            color: #191970;
            margin: 0 0 10px 0;
        }

        .booking-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin: 0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #0047AB;
            font-size: 0.95rem;
        }

        .form-label i {
            font-size: 0.9rem;
        }

        .form-input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #0047AB;
            box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
        }

        /* Select dropdown styling - only for location dropdown */
        select.form-input {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230047AB' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        select.form-input option {
            padding: 8px 12px;
            background: white;
            color: #333;
        }

        select.form-input option:hover {
            background: #f8f9fa;
        }

        .booking-summary {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .summary-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #191970;
        }

        .total-item {
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 71, 171, 0.1);
        }

        .total-price {
            font-size: 1.5rem;
            color: #0047AB;
        }

        .booking-button {
            width: 100%;
            background: linear-gradient(135deg, #0047AB 0%, #191970 100%);
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 71, 171, 0.3);
        }

        .booking-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 71, 171, 0.4);
        }

        .booking-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .featured-section {
            margin-top: 60px;
            padding: 40px 20px;
        }

        .featured-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .featured-title {
            font-size: 2.2rem;
            font-weight: bold;
            color: #191970;
            margin: 0 0 10px 0;
        }

        .featured-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin: 0;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .featured-product {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
        }

        .featured-product:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 30px rgba(0, 71, 171, 0.2);
            border-color: #0047AB;
        }

        .featured-product img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .featured-product:hover img {
            transform: scale(1.05);
        }

        .featured-product-info {
            padding: 25px;
        }

        .featured-product-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #191970;
            margin: 0 0 10px 0;
        }

        .featured-product-type {
            font-size: 1rem;
            color: #666;
            margin: 0 0 15px 0;
            line-height: 1.4;
        }

        .featured-product-price {
            font-size: 1.4rem;
            color: #0047AB;
            font-weight: bold;
            margin: 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0047AB;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .product-overview {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .product-title {
                font-size: 2rem;
            }

            .price-amount {
                font-size: 1.5rem;
            }

            .product-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .booking-summary {
                flex-direction: column;
                align-items: stretch;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .featured-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }
        }
    </style>
</head>
<body class="body-bg">

    <div class="product-hero">
        <div class="hero-content">
            <div class="back-navigation">
                <a href="Services.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Services</span>
                </a>
            </div>
            <div class="product-overview">
                <div class="product-image-section">
                    <div class="image-container">
                        <img src="https://placehold.co/400x300" alt="Sound System Equipment" class="product-image" id="productImage" />
                        <div class="image-overlay">
                            <div class="stock-badge" id="stockBadge">
                                <span id="stockStatus">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="product-details">
                    <div class="product-header">
                        <h1 class="product-title" id="productTitle">PRODUCT NAME</h1>
                        <div class="product-price-display">
                            <span class="price-amount" id="price-display">â‚±250/day</span>
                            <span class="price-label">per day</span>
                        </div>
                    </div>
                    
                    <div class="product-description">
                        <p class="core-description" id="coreDescription" style="display:none;"></p>
                        <p class="equipment-description" id="equipmentDescription">
                            <!-- Description will be filled dynamically -->
                        </p>
                    </div>
                    
                    <div class="product-actions">
                        <div class="quantity-selector">
                            <label for="quantityInput" class="quantity-label">Quantity:</label>
                            <div class="quantity-input-wrapper">
                                <button type="button" class="quantity-btn" onclick="decrementQuantity()">-</button>
                                <input type="number" id="quantityInput" name="quantity" value="1" min="1" max="10" />
                                <button type="button" class="quantity-btn" onclick="incrementQuantity()">+</button>
                            </div>
                        </div>
                        
                        <div class="stock-status">
                            <div class="status-indicator" id="statusIndicator">
                                <i class="fas fa-circle"></i>
                                <span id="stockStatusText">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="soldOutMessage" class="sold-out-message" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>SOLD OUT - No units available for booking</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

            <!-- Booking Form -->
            <div class="booking-section">
                <div class="booking-header">
                    <h2 class="booking-title">ðŸ“… Book This Equipment</h2>
                    <p class="booking-subtitle">Fill in the details below to reserve your equipment</p>
                </div>
                
                <form class="booking-form" id="bookingForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="startDate" class="form-label">
                                <i class="fas fa-calendar-plus"></i>
                                Start Date
                            </label>
                            <input type="date" id="startDate" name="startDate" required class="form-input" />
                        </div>
                        
                        <div class="form-group">
                            <label for="endDate" class="form-label">
                                <i class="fas fa-calendar-minus"></i>
                                End Date
                            </label>
                            <input type="date" id="endDate" name="endDate" required class="form-input" />
                        </div>
                        
                        <div class="form-group">
                            <label for="venue" class="form-label">
                                <i class="fas fa-building"></i>
                                Venue Name
                            </label>
                            <input type="text" id="venue" name="venue" placeholder="Enter venue name..." required class="form-input" />
                        </div>
                        
                        <div class="form-group">
                            <label for="location" class="form-label">
                                <i class="fas fa-map-marker-alt"></i>
                                Location
                            </label>
                            <select id="location" name="location" required class="form-input">
                                <option value="">Select a location...</option>
                                <option value="Bulacan">Bulacan</option>
                                <option value="Cavite">Cavite</option>
                                <option value="Laguna">Laguna</option>
                                <option value="Manila">Manila</option>
                                <option value="Pampanga">Pampanga</option>
                                <option value="Tagaytay">Tagaytay</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventTime" class="form-label">
                                <i class="fas fa-clock"></i>
                                Event Time
                            </label>
                            <input type="time" id="eventTime" name="eventTime" required class="form-input" />
                        </div>
                    </div>
                    
                    <div class="booking-summary">
                        <div class="summary-item">
                            <span class="summary-label">Duration:</span>
                            <span class="summary-value" id="durationDisplay">0 days</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Quantity:</span>
                            <span class="summary-value" id="quantityDisplay">1 unit</span>
                        </div>
                        <div class="summary-item total-item">
                            <span class="summary-label">Total Price:</span>
                            <span class="summary-value total-price" id="totalPrice">â‚±0</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="booking-button" id="bookingButton">
                        <i class="fas fa-check-circle"></i>
                        <span>Book Now</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- Featured Items Section -->
    <div class="featured-section">
        <div class="featured-header">
            <h2 class="featured-title">ðŸŽµ Other Equipment You Might Like</h2>
            <p class="featured-subtitle">Explore our complete range of audio and lighting equipment</p>
        </div>
        <div class="featured-grid" id="featuredItemsGrid"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="firebase-config-new.js"></script>
    <script src="firebase-backend-new.js"></script>
    <script>
      // Map service/bundle names to image files in the images folder
      const serviceImages = {
        'Lights & Sounds': 'images/lights-sounds.png',
        'Led Wall': 'images/led-wall.png',
        'Stage': 'images/stage.png',
        'Mood Light': 'images/mood-lights.png',
        'String Lights': 'images/string-lights.png',
        'Low Lying': 'images/low-lying.jpg',
        // Add more mappings as needed
      };
      // Core equipment descriptions (from availability.html)
      const coreEquipmentDescriptions = {
        'Lights & Sounds': 'Our core package delivers high-quality audio systems paired with dynamic lighting effects. Perfect for weddings, birthdays, and corporate events, it ensures crystal-clear sound and vibrant visual experiences that energize any crowd.',
        'Led Wall': 'Wow your audience with our high-resolution LED wall. Perfect for live video feeds, slideshows, branding, or visual effects, it delivers stunning visuals that make a lasting impression at concerts, conferences, and big celebrations.',
        'Stage': 'Ensure your performers and speakers have the platform they need with our professional stage setups. Designed for safety, visibility, and aesthetic appeal, our stages suit everything from intimate gatherings to large-scale productions.',
        'Mood Light': 'Set the perfect tone with customizable mood lighting. Our LED uplights and color washes adapt to any theme, from classy and elegant to fun and vibrant, making your venue truly unforgettable.',
        'String Lights': 'Transform your venue with warm, romantic ambience using our elegant string lights. Ideal for garden weddings and outdoor receptions, they add a charming glow that enhances every moment and photograph.',
        'Low Lying': 'Create a dramatic "dancing on a cloud" effect with our low-lying fog machine. Perfect for first dances and grand entrances, it delivers a magical atmosphere that captivates guests and elevates your event.'
      };
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }
      // Quantity increment/decrement functions
      function incrementQuantity() {
        const quantityInput = document.getElementById('quantityInput');
        const currentValue = parseInt(quantityInput.value) || 1;
        const maxValue = parseInt(quantityInput.max) || 10;
        
        if (currentValue < maxValue) {
          quantityInput.value = currentValue + 1;
          updateQuantityDisplay();
          calculatePrice();
        }
      }

      function decrementQuantity() {
        const quantityInput = document.getElementById('quantityInput');
        const currentValue = parseInt(quantityInput.value) || 1;
        const minValue = parseInt(quantityInput.min) || 1;
        
        if (currentValue > minValue) {
          quantityInput.value = currentValue - 1;
          updateQuantityDisplay();
          calculatePrice();
        }
      }

      function updateQuantityDisplay() {
        const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
        const quantityDisplay = document.getElementById('quantityDisplay');
        if (quantityDisplay) {
          quantityDisplay.textContent = `${quantity} unit${quantity > 1 ? 's' : ''}`;
        }
      }

      function updateDurationDisplay() {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const durationDisplay = document.getElementById('durationDisplay');
        
        if (startDateInput.value && endDateInput.value) {
          const startDate = new Date(startDateInput.value);
          const endDate = new Date(endDateInput.value);
          
          if (endDate >= startDate) {
            const timeDiff = endDate - startDate;
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
            durationDisplay.textContent = `${daysDiff} day${daysDiff > 1 ? 's' : ''}`;
          } else {
            durationDisplay.textContent = '0 days';
          }
        } else {
          durationDisplay.textContent = '0 days';
        }
      }

      document.addEventListener('DOMContentLoaded', async function() {
        const productId = getQueryParam('productId');
        const bundleId = getQueryParam('bundleId');
        const db = firebase.database();
        let currentName = '';
        
        // Show loading state
        document.getElementById('productTitle').textContent = 'Loading...';
        document.getElementById('productImage').src = 'images/logo.png';
        
        if (productId) {
          const snap = await db.ref('services/' + productId).once('value');
          const product = snap.val();
          if (!product) return;
          
          document.getElementById('productTitle').textContent = product.name;
          document.getElementById('productImage').src = serviceImages[product.name] || 'images/logo.png';
          document.getElementById('equipmentDescription').textContent = product.inclusions || '';
          document.getElementById('price-display').textContent = 'â‚±' + product.price;
          currentName = product.name;
          
          // Update the booking form price
          updatePrice(product.price);
          
          // Show core equipment description if available
          const coreDesc = coreEquipmentDescriptions[product.name];
          const coreDescElem = document.getElementById('coreDescription');
          if (coreDesc) {
            coreDescElem.textContent = coreDesc;
            coreDescElem.style.display = 'block';
          } else {
            coreDescElem.style.display = 'none';
          }
          
          // Set availableStock and max quantity
          availableStock = product.available !== undefined ? parseInt(product.available) : 10;
          updateAvailableStockDisplay(availableStock);
          
        } else if (bundleId) {
          const snap = await db.ref('bundles/' + bundleId).once('value');
          const bundle = snap.val();
          if (!bundle) return;
          
          document.getElementById('productTitle').textContent = bundle.name;
          let bundleImage = 'images/logo.png';
          if (bundle.services && bundle.services.length > 0) {
            const firstService = bundle.services[0];
            bundleImage = serviceImages[firstService] || 'images/logo.png';
          }
          document.getElementById('productImage').src = bundleImage;
          document.getElementById('equipmentDescription').textContent = (bundle.services||[]).join(', ');
          document.getElementById('price-display').textContent = 'â‚±' + bundle.price;
          currentName = bundle.name;
          
          // Update the booking form price
          updatePrice(bundle.price);
          
          // Hide core description for bundles
          const coreDescElem = document.getElementById('coreDescription');
          coreDescElem.style.display = 'none';
          
          // Set availableStock and max quantity for bundles
          availableStock = bundle.available !== undefined ? parseInt(bundle.available) : 10;
          updateAvailableStockDisplay(availableStock);
        }
        
        // Load and display featured items (all other services)
        const featuredGrid = document.getElementById('featuredItemsGrid');
        if (featuredGrid) {
          featuredGrid.innerHTML = `
            <div class="loading-spinner" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
              <div class="loading-spinner"></div>
              <p style="margin-top: 15px; color: #666;">Loading featured items...</p>
            </div>
          `;
          
          try {
            const servicesSnap = await db.ref('services').once('value');
            const services = servicesSnap.val() || {};
            
            if (Object.keys(services).length === 0) {
              featuredGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                  <i class="fas fa-microphone-slash" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                  <h3>No Other Services Available</h3>
                  <p>Check back later for more equipment options.</p>
                </div>
              `;
            } else {
              featuredGrid.innerHTML = '';
              Object.entries(services).forEach(([id, s]) => {
                if (s.name === currentName) return; // Skip current item
                const imgSrc = serviceImages[s.name] || 'images/logo.png';
                const div = document.createElement('div');
                div.className = 'featured-product';
                div.innerHTML = `
                  <a href="Prod Description.html?productId=${id}">
                    <img src="${imgSrc}" alt="${s.name}">
                  </a>
                  <div class="featured-product-info">
                    <p class="featured-product-title">${s.name}</p>
                    <p class="featured-product-type">${s.inclusions || ''}</p>
                    <p class="featured-product-price"><b>â‚±${s.price}</b></p>
                  </div>
                `;
                featuredGrid.appendChild(div);
              });
            }
          } catch (error) {
            console.error('Error loading featured items:', error);
            featuredGrid.innerHTML = `
              <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                <h3>Error Loading Featured Items</h3>
                <p>Please refresh the page to try again.</p>
              </div>
            `;
          }
        }
        
        // Initialize displays
        updateQuantityDisplay();
        updateDurationDisplay();
      });
    </script>
    <script>
        let currentPrice = 250; // Default price, will be updated from product data
        let availableStock = 10; // Simulated database value

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('stockStatus').innerText = `${availableStock} unit(s) available`;
            
            // Set minimum date for start date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
        });

        function calculatePrice() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const quantityInput = document.getElementById('quantityInput');
            const totalPriceDisplay = document.getElementById('totalPrice');

            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const quantity = parseInt(quantityInput.value) || 1;

            if (startDateInput.value && endDateInput.value && endDate >= startDate) {
                const timeDiff = endDate - startDate;
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
                const totalPrice = daysDiff * currentPrice * quantity;
                totalPriceDisplay.innerText = `â‚±${totalPrice}`;
            } else {
                totalPriceDisplay.innerText = 'â‚±0';
            }
            
            // Update duration display
            updateDurationDisplay();
        }

        // Update price when product data is loaded
        function updatePrice(price) {
            currentPrice = price;
            calculatePrice();
        }

        document.getElementById('startDate').addEventListener('input', calculatePrice);
        document.getElementById('endDate').addEventListener('input', calculatePrice);

        // Set minimum date for end date based on start date
        document.getElementById('startDate').addEventListener('change', function() {
            const startDate = this.value;
            const endDateInput = document.getElementById('endDate');
            
            if (startDate) {
                // Set minimum date for end date to be the start date
                endDateInput.min = startDate;
                
                // If end date is before start date, clear it
                if (endDateInput.value && endDateInput.value < startDate) {
                    endDateInput.value = '';
                    calculatePrice();
                }
            }
        });

        document.getElementById('quantityInput').addEventListener('input', () => {
            const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
            if (quantity > availableStock) {
                alert(`Only ${availableStock} unit(s) are available.`);
                document.getElementById('quantityInput').value = availableStock;
            }
            updateQuantityDisplay();
            calculatePrice();
        });

        // Form submission handling
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const quantity = document.getElementById('quantityInput').value;
            const venue = document.getElementById('venue').value;
            const location = document.getElementById('location').value;
            const eventTime = document.getElementById('eventTime').value;
            
            if (!startDate || !endDate) {
                alert('Please select both start and end dates.');
                return;
            }
            
            if (!venue || !location || !eventTime) {
                alert('Please fill in all required fields: venue, location, and event time.');
                return;
            }
            
            if (new Date(endDate) < new Date(startDate)) {
                alert('End date cannot be before start date.');
                return;
            }
            
            // Allow booking without login
            let customer = 'Guest';
            let customerName = 'Guest';
            let customerUid = null;
            if (firebase.auth && typeof firebase.auth === 'function' && firebase.auth().currentUser) {
                const user = firebase.auth().currentUser;
                customer = user.email || 'Guest';
                customerName = user.displayName || user.email || 'Guest';
                customerUid = user.uid;
            }
            
            // Get product/bundle ID and type
            const productId = getQueryParam('productId');
            const bundleId = getQueryParam('bundleId');
            const finalProductId = productId || bundleId;
            const productType = productId ? 'service' : 'bundle';
            
            console.log('ðŸ” Creating booking with:');
            console.log('Product ID from URL:', productId);
            console.log('Bundle ID from URL:', bundleId);
            console.log('Final Product ID:', finalProductId);
            console.log('Product Type:', productType);
            
            // Create booking data
            const bookingData = {
                productName: document.getElementById('productTitle').textContent,
                startDate: startDate,
                endDate: endDate,
                quantity: parseInt(quantity),
                totalPrice: document.getElementById('totalPrice').textContent,
                customer: customer,
                customerName: customerName,
                customerUid: customerUid,
                venue: venue,
                location: location,
                eventTime: eventTime,
                status: 'Pending',
                timestamp: new Date().toISOString(),
                productId: finalProductId,
                productType: productType
            };
            
            console.log('ðŸ“‹ Final booking data:', bookingData);
            
            try {
                // Save booking to Firebase
                const db = firebase.database();
                const bookingRef = await db.ref('bookings').push(bookingData);
                
                console.log('Booking saved with ID:', bookingRef.key);
                // Show notification
                alert('Booking submitted successfully! We will contact you soon to confirm your reservation. You will be redirected to the Services page.');
                
                // Reset form
                document.getElementById('bookingForm').reset();
                document.getElementById('totalPrice').textContent = 'â‚±0';
                
                // Reset date constraints
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('startDate').min = today;
                document.getElementById('endDate').min = '';
                
                // Decrement available stock for product or bundle
                try {
                  const isService = !!getQueryParam('productId');
                  const refPath = isService ? 'services/' + getQueryParam('productId') : 'bundles/' + getQueryParam('bundleId');
                  const itemSnap = await db.ref(refPath).once('value');
                  const item = itemSnap.val();
                  if (item && typeof item.available !== 'undefined') {
                    let newAvailable = parseInt(item.available) - parseInt(quantity);
                    if (newAvailable < 0) newAvailable = 0;
                    await db.ref(refPath + '/available').set(newAvailable);
                    // Update the displayed available quantity on the page
                    document.getElementById('stockStatus').innerText = `${newAvailable} unit(s) available`;
                  }
                } catch (err) {
                  console.error('Error updating available stock:', err);
                }
                
                // Redirect to Services.html after 2 seconds
                setTimeout(function() {
                  window.location.href = 'Services.html';
                }, 2000);
                
            } catch (error) {
                console.error('Error saving booking:', error);
                alert('Error submitting booking. Please try again.');
            }
        });
    </script>
    <script>
// Real-time available units update for product or bundle
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

// Function to update available stock display
function updateAvailableStockDisplay(availableStock) {
  const stockStatusElement = document.getElementById('stockStatus');
  const stockStatusText = document.getElementById('stockStatusText');
  const quantityInput = document.getElementById('quantityInput');
  const soldOutMessage = document.getElementById('soldOutMessage');
  const bookingButton = document.getElementById('bookingButton');
  const statusIndicator = document.getElementById('statusIndicator');
  
  if (stockStatusElement) {
    if (availableStock === 0) {
      stockStatusElement.innerText = 'ðŸš« SOLD OUT';
      stockStatusElement.style.background = 'rgba(220, 53, 69, 0.9)';
    } else {
      stockStatusElement.innerText = `${availableStock} unit(s) available`;
      stockStatusElement.style.background = 'rgba(0, 71, 171, 0.9)';
    }
  }
  
  if (stockStatusText) {
    if (availableStock === 0) {
      stockStatusText.innerText = 'Sold Out';
      statusIndicator.style.background = 'rgba(220, 53, 69, 0.1)';
      statusIndicator.style.color = '#dc3545';
    } else {
      stockStatusText.innerText = `${availableStock} unit(s) available`;
      statusIndicator.style.background = 'rgba(0, 71, 171, 0.1)';
      statusIndicator.style.color = '#0047AB';
    }
  }
  
  if (quantityInput) {
    quantityInput.max = availableStock;
    if (parseInt(quantityInput.value) > availableStock) {
      quantityInput.value = availableStock;
      updateQuantityDisplay();
    }
    
    // Disable quantity input if sold out
    if (availableStock === 0) {
      quantityInput.disabled = true;
      quantityInput.style.backgroundColor = '#f8f9fa';
      quantityInput.style.color = '#6c757d';
    } else {
      quantityInput.disabled = false;
      quantityInput.style.backgroundColor = 'white';
      quantityInput.style.color = 'black';
    }
  }
  
  // Show/hide sold out message
  if (soldOutMessage) {
    if (availableStock === 0) {
      soldOutMessage.style.display = 'flex';
    } else {
      soldOutMessage.style.display = 'none';
    }
  }
  
  // Disable booking button if sold out
  if (bookingButton) {
    console.log('Booking button found, availableStock:', availableStock);
    if (availableStock === 0) {
      bookingButton.disabled = true;
      bookingButton.innerHTML = '<i class="fas fa-times-circle"></i><span>Sold Out</span>';
      console.log('Booking button disabled - sold out');
    } else {
      bookingButton.disabled = false;
      bookingButton.innerHTML = '<i class="fas fa-check-circle"></i><span>Book Now</span>';
      console.log('Booking button enabled - stock available');
    }
  } else {
    console.warn('Booking button not found!');
  }
  
  console.log('Updated available stock to:', availableStock);
}

document.addEventListener('DOMContentLoaded', function() {
  const productId = getQueryParam('productId');
  const bundleId = getQueryParam('bundleId');
  
  // Ensure booking button is enabled by default
  const bookingButton = document.getElementById('bookingButton');
  if (bookingButton) {
    bookingButton.disabled = false;
    bookingButton.innerHTML = '<i class="fas fa-check-circle"></i><span>Book Now</span>';
    console.log('Booking button initialized as enabled');
  }
  
  if (typeof firebase === 'undefined' || !firebase.database) {
    console.warn('Firebase not available for real-time updates');
    return;
  }
  
  const db = firebase.database();
  let ref = null;
  
  if (productId) {
    ref = db.ref('services/' + productId);
    console.log('Setting up real-time listener for service:', productId);
  } else if (bundleId) {
    ref = db.ref('bundles/' + bundleId);
    console.log('Setting up real-time listener for bundle:', bundleId);
  }
  
  if (ref) {
    ref.on('value', snap => {
      const item = snap.val();
      console.log('Real-time update received:', item);
      
      if (!item) {
        console.warn('No item data received');
        return;
      }
      
      const availableStock = item.available !== undefined ? parseInt(item.available) : 10; // Default to 10 if not specified
      console.log('Real-time stock update:', availableStock);
      updateAvailableStockDisplay(availableStock);
    }, (error) => {
      console.error('Error in real-time listener:', error);
    });
  } else {
    console.warn('No product or bundle ID found in URL');
  }
});
</script>
</body>
</html>
